{#- Navigation component matching otherdev.com design -#}

{#- Define navigation links -#}
{%- set navLinks = [
  { title: "Home", path: "/" },
  { title: "Archive", path: "/blog/" },
  { title: "About", path: "/about/" },
  { title: "Feed", path: "/feed/feed.xml", target: "_blank" }
] -%}

{#- Action links -#}
{%- set letsMeetLink = {
  title: "Let's meet",
  path: "https://calendly.com/otherdev/30-minute-consultation-call-1",
  target: "_blank",
  icon: "externalLink"
} -%}

{#- Social links -#}
{%- set socialLinks = [
  {
    title: "LinkedIn", 
    path: "https://www.linkedin.com/company/theotherdev/",
    icon: "linkedin"
  },
  {
    title: "Instagram",
    path: "https://instagram.com/other.dev", 
    icon: "instagram"
  }
] -%}

{#- Mobile Navigation -#}
<nav aria-label="Mobile Navigation" class="lg:hidden flex justify-between header-blend-mode items-center w-full px-4 pt-4 text-sm fixed top-0 z-50">
  <div>
    <a href="/" class="w-full flex-1/2 font-queens text-lg" aria-label="The Other Dev速 Home">The Other Dev速</a>
  </div>
  <div class="flex items-center gap-4">
    <div class="font-twk text-xs text-right">
      <span id="mobile-clock" class="block min-w-[12ch] tabular-nums">--:-- PKT</span>
      <p class="opacity-90">Karachi</p>
    </div>
    <button id="mobile-nav-toggle" aria-expanded="false" aria-controls="mobile-menu" class="mobile-navigation-trigger p-2 -mr-2">
    <span class="sr-only">Menu</span>
    <div class="relative h-6 overflow-hidden">
      <span class="menu-text block">Menu</span>
      <span class="close-text absolute top-0 right-0 translate-y-6">Close</span>
    </div>
  </button>
</nav>

{#- Mobile Menu Panel -#}
<div id="mobile-menu" class="menu-withclock fixed inset-0 z-40 text-black bg-stone-300 lg:hidden will-change-transform" style="transform: translateY(100%)" aria-hidden="true">
  <div class="pt-24 h-full overflow-y-auto">
    <ul class="pb-20" aria-label="Mobile Navigation Links">
      {#- Main Nav Links -#}
      {% for item in navLinks %}
        <li class="border-b border-black">
          <a href="{{ item.path }}"{% if item.target %} target="{{ item.target }}" rel="noopener noreferrer"{% endif %} class="block py-4 px-4 text-lg hover:bg-stone-600/10 transition-colors duration-200">
            {{ item.title }}
          </a>
        </li>
      {% endfor %}
      
      {#- Let's Meet Link -#}
      <li class="border-b border-black border-dashed">
        <a href="{{ letsMeetLink.path }}" target="_blank" rel="noopener noreferrer" class="block py-4 px-4 text-lg hover:bg-stone-600/10 transition-colors duration-200">
          {{ letsMeetLink.title }}
        </a>
      </li>
      
      {#- Software and Design -#}
      <li class="border-b border-black border-dashed">
        <div class="block py-4 px-4 text-lg hover:bg-stone-600/10 transition-colors duration-200">
          <span>Software and Design</span>
        </div>
      </li>
    </ul>

    {#- Mobile Footer Social Links -#}
    <div class="fixed px-4 bottom-0 left-0 w-full bg-stone-400/90 backdrop-blur-sm flex justify-between items-center py-4 border-t border-black">
      {% for link in socialLinks %}
        <a href="{{ link.path }}" target="_blank" rel="noopener noreferrer" class="flex items-center hover:opacity-80 transition-opacity nav-text" aria-label="{{ link.title }} (opens in a new tab)">
          {{ icons[link.icon] | safe }}
          <span class="ml-2 text-sm">{{ link.title }}</span>
        </a>
      {% endfor %}
    </div>
  </div>
</div>

{#- Desktop Navigation -#}
<nav aria-label="Primary Navigation" class="menu-withclock hidden lg:block w-full pt-4 px-4 text-lg header-blend-mode fixed top-0 z-50">
  <div class="flex justify-between items-center lg:container mx-auto">
    <div class="font-bold font-queens text-xl">
      <a href="/" class="before:bg-black dynamic-underline-left cursor-arrow-right hover:opacity-75 transition-all" aria-label="The Other Dev速 Home">The Other Dev速</a>
    </div>

    <div class="font-twk">
      <p>Software and Design</p>
    </div>

    <div class="flex items-center gap-2 font-twk text-sm">
      <span id="desktop-clock" class="min-w-[17ch] tabular-nums">--:-- PKT</span>
      <p class="text-xs opacity-90">Karachi</p>
    </div>

    {#- Main Desktop Links -#}
    <ul class="flex gap-6">
      {% for item in navLinks %}
        <li>
          <a href="{{ item.path }}"{% if item.target %} target="{{ item.target }}" rel="noopener noreferrer"{% endif %} class="font-twk before:bg-black dynamic-underline-left hover:opacity-75 transition-all cursor-arrow-right"{% if item.path == page.url %} aria-current="page"{% endif %}>
            {{ item.title }}
          </a>
        </li>
      {% endfor %}
    </ul>

    {#- Desktop Right-Side Links (Action & Social) -#}
    <ul class="flex gap-4 items-center">
      <li>
        <a href="{{ letsMeetLink.path }}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-sm font-twk hover:opacity-80 transition-opacity cursor-arrow-right" aria-label="{{ letsMeetLink.title }} (opens in a new tab)">
          <span class="font-medium">{{ letsMeetLink.title }}</span>
          {{ icons[letsMeetLink.icon] | safe }}
        </a>
      </li>
      {% for link in socialLinks %}
        <li>
          <a href="{{ link.path }}" target="_blank" rel="noopener noreferrer" class="flex items-center hover:opacity-80 transition-opacity" aria-label="{{ link.title }} (opens in a new tab)">
            {{ icons[link.icon] | safe }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
</nav>

{#- Navigation Styles -#}
<style>
  .header-blend-mode {
    mix-blend-mode: difference; 
    will-change: transform; 
    isolation: isolate; 
  }
  
  /* Dynamic underlines now handled in global CSS */
  
  .font-queens {
    font-family: var(--font-family-heading);
  }
  
  .font-twk {
    font-family: var(--font-family);
  }
  
  /* Mobile menu transitions */
  #mobile-menu {
    transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
    transform: translateY(100%);
  }
  
  /* Mobile navigation text animation */
  .mobile-navigation-trigger .menu-text,
  .mobile-navigation-trigger .close-text {
    transition: transform 0.3s ease;
  }
  
  .mobile-navigation-trigger[aria-expanded="true"] .menu-text {
    transform: translateY(-24px);
  }
  
  .mobile-navigation-trigger[aria-expanded="true"] .close-text {
    transform: translateY(0);
  }
</style>

{#- Navigation Scripts -#}
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const menuButton = document.getElementById('mobile-nav-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuText = menuButton.querySelector('.menu-text');
  const closeText = menuButton.querySelector('.close-text');
  const body = document.body;
  
  if (menuButton && mobileMenu) {
    // Set initial position with GSAP
    gsap.set(mobileMenu, { y: '100%' });
    
    menuButton.addEventListener('click', function() {
      const isOpen = menuButton.getAttribute('aria-expanded') === 'true';
      
      // Toggle menu visibility with improved GSAP animations
      if (isOpen) {
        // Close menu with smooth easing
        gsap.to(mobileMenu, { 
          duration: 0.6, 
          y: '100%', 
          ease: "power3.inOut" 
        });
        // Animate text swap with stagger
        gsap.to(closeText, { duration: 0.25, y: 24, ease: "power2.out" });
        gsap.to(menuText, { duration: 0.25, y: 0, ease: "power2.out", delay: 0.1 });
        body.style.overflow = '';
      } else {
        // Open menu with smooth easing
        gsap.to(mobileMenu, { 
          duration: 0.6, 
          y: '0%', 
          ease: "power3.inOut" 
        });
        // Animate text swap with stagger
        gsap.to(menuText, { duration: 0.25, y: -24, ease: "power2.out" });
        gsap.to(closeText, { duration: 0.25, y: 0, ease: "power2.out", delay: 0.1 });
        body.style.overflow = 'hidden';
      }
      
      // Update accessibility attributes
      menuButton.setAttribute('aria-expanded', !isOpen);
      mobileMenu.setAttribute('aria-hidden', isOpen);
    });
    
    // Close menu when clicking on links
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(link => {
      link.addEventListener('click', function() {
        gsap.to(mobileMenu, { 
          duration: 0.5, 
          y: '100%', 
          ease: "power2.inOut" 
        });
        gsap.to(closeText, { duration: 0.3, y: 24, ease: "power2.inOut" });
        gsap.to(menuText, { duration: 0.3, y: 0, ease: "power2.inOut" });
        menuButton.setAttribute('aria-expanded', 'false');
        mobileMenu.setAttribute('aria-hidden', 'true');
        body.style.overflow = '';
      });
    });
  }

  // Clock functionality
  function updateClocks() {
    const options = {
      timeZone: 'Asia/Karachi',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true
    };

    try {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', options);
      const displayTime = timeString + ' PKT';
      
      // Update both desktop and mobile clocks
      const desktopClock = document.getElementById('desktop-clock');
      const mobileClock = document.getElementById('mobile-clock');
      
      if (desktopClock) desktopClock.textContent = displayTime;
      if (mobileClock) mobileClock.textContent = displayTime;
      
      console.log('Clock updated:', displayTime); // Debug log
    } catch (e) {
      console.error('Clock update failed:', e);
      // Fallback display
      const fallbackTime = '--:-- PKT';
      const desktopClock = document.getElementById('desktop-clock');
      const mobileClock = document.getElementById('mobile-clock');
      
      if (desktopClock) desktopClock.textContent = fallbackTime;
      if (mobileClock) mobileClock.textContent = fallbackTime;
    }
  }

  // Initialize clock
  updateClocks();
  const clockInterval = setInterval(updateClocks, 1000);
});
</script>